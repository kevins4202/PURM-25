Loading and quantizing model  Llama-3.1-8B-Instruct
Loading checkpoint shards:   0%|          | 0/4 [00:00<?, ?it/s]Loading checkpoint shards:  25%|██▌       | 1/4 [00:03<00:09,  3.21s/it]Loading checkpoint shards:  50%|█████     | 2/4 [00:06<00:06,  3.10s/it]Loading checkpoint shards:  75%|███████▌  | 3/4 [00:09<00:03,  3.17s/it]Loading checkpoint shards: 100%|██████████| 4/4 [00:10<00:00,  2.20s/it]Loading checkpoint shards: 100%|██████████| 4/4 [00:10<00:00,  2.55s/it]
Using prompt:  granular_0_shot.txt

Evaluation Configuration:
Model: meta-llama/Llama-3.1-8B-Instruct
Broad evaluation: False
Zero-shot: True
Structured output: False

Loading data

batch 1 of 3456
NOTE: SOCIAL WORK CARE PLAN NOTEProblem: ADJUSTMENTG...
Failed to generate output: No JSON content found in unstructured output: ...


Getting annotations...
Error parsing output: 'NoneType' object is not subscriptable None

batch 2 of 3456
NOTE: SOCIAL WORK CARE PLAN NOTEProblem: ADJUSTMENTG...
Failed to generate output: No JSON content found in unstructured output: ...


Getting annotations...
Error parsing output: 'NoneType' object is not subscriptable None

batch 3 of 3456
NOTE: The Children's Hospital of Philadelphia    SO...
Failed to generate output: No JSON content found in unstructured output: ...


Getting annotations...
Error parsing output: 'NoneType' object is not subscriptable None

batch 4 of 3456
NOTE: Social Work Care Plan NotePatient's Name:  Yari...
Failed to generate output: No JSON content found in unstructured output: ...


Getting annotations...
Error parsing output: 'NoneType' object is not subscriptable None

batch 5 of 3456
NOTE: The Children's Hospital of Philadelphia    SO...
Failed to generate output: No JSON content found in unstructured output: ...


Getting annotations...
Error parsing output: 'NoneType' object is not subscriptable None

batch 6 of 3456
NOTE: SOCIAL WORK CARE PLAN NOTEProblem: ADJUSTMENT...
Failed to generate output: No JSON content found in unstructured output: ...


Getting annotations...
Error parsing output: 'NoneType' object is not subscriptable None

batch 7 of 3456
NOTE: SOCIAL WORK CARE PLAN NOTEProblem: RESOURCE NEE...
Failed to generate output: No JSON content found in unstructured output: ...


Getting annotations...
Error parsing output: 'NoneType' object is not subscriptable None

batch 8 of 3456
NOTE: SOCIAL WORK CARE PLAN NOTEProblem: ADJUSTMENTG...
Failed to generate output: No JSON content found in unstructured output: ...


Getting annotations...
Error parsing output: 'NoneType' object is not subscriptable None

batch 9 of 3456
NOTE: The Children's Hospital of Philadelphia TRANSPLA...
Failed to generate output: No JSON content found in unstructured output: ...


Getting annotations...
Error parsing output: 'NoneType' object is not subscriptable None

batch 10 of 3456
NOTE: SOCIAL WORK CARE PLAN NOTEProblem: ADJUSTMENTG...
Failed to generate output: No JSON content found in unstructured output: ...


Getting annotations...
Error parsing output: 'NoneType' object is not subscriptable None

batch 11 of 3456
NOTE: SOCIAL WORK CARE PLAN NOTEProblem: ADJUSTMENT...
Failed to generate output: No JSON content found in unstructured output: ...


Getting annotations...
Error parsing output: 'NoneType' object is not subscriptable None

batch 12 of 3456
NOTE: SOCIAL WORK CARE PLAN NOTEProblem: RESOURCE NEE...
Failed to generate output: No JSON content found in unstructured output: ...


Getting annotations...
Error parsing output: 'NoneType' object is not subscriptable None

batch 13 of 3456
NOTE: The Children's Hospital of Philadelphia    SO...
Traceback (most recent call last):
  File "/home/songk1/Documents/PURM-25/evaluation.py", line 247, in <module>
    main()
  File "/home/songk1/Documents/PURM-25/evaluation.py", line 240, in main
    preds, targets, broken_indices = evaluator.evaluate(dataloader)
                                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/songk1/Documents/PURM-25/evaluation.py", line 136, in evaluate
    pred = self.generate_output(notes[i])
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/songk1/Documents/PURM-25/evaluation.py", line 85, in generate_output
    outputs = self.generator.generate(
              ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/songk1/miniconda3/envs/purm/lib/python3.11/site-packages/torch/utils/_contextlib.py", line 116, in decorate_context
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/home/songk1/miniconda3/envs/purm/lib/python3.11/site-packages/transformers/generation/utils.py", line 2597, in generate
    result = self._sample(
             ^^^^^^^^^^^^^
  File "/home/songk1/miniconda3/envs/purm/lib/python3.11/site-packages/transformers/generation/utils.py", line 3560, in _sample
    outputs = model_forward(**model_inputs, return_dict=True)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/songk1/miniconda3/envs/purm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1751, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/songk1/miniconda3/envs/purm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1762, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/songk1/miniconda3/envs/purm/lib/python3.11/site-packages/transformers/utils/generic.py", line 969, in wrapper
    output = func(self, *args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/songk1/miniconda3/envs/purm/lib/python3.11/site-packages/transformers/models/llama/modeling_llama.py", line 688, in forward
    outputs: BaseModelOutputWithPast = self.model(
                                       ^^^^^^^^^^^
  File "/home/songk1/miniconda3/envs/purm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1751, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/songk1/miniconda3/envs/purm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1762, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/songk1/miniconda3/envs/purm/lib/python3.11/site-packages/transformers/utils/generic.py", line 969, in wrapper
    output = func(self, *args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/songk1/miniconda3/envs/purm/lib/python3.11/site-packages/transformers/models/llama/modeling_llama.py", line 453, in forward
    layer_outputs = decoder_layer(
                    ^^^^^^^^^^^^^^
  File "/home/songk1/miniconda3/envs/purm/lib/python3.11/site-packages/transformers/modeling_layers.py", line 48, in __call__
    return super().__call__(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/songk1/miniconda3/envs/purm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1751, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/songk1/miniconda3/envs/purm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1762, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/songk1/miniconda3/envs/purm/lib/python3.11/site-packages/transformers/models/llama/modeling_llama.py", line 324, in forward
    hidden_states = self.mlp(hidden_states)
                    ^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/songk1/miniconda3/envs/purm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1751, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/songk1/miniconda3/envs/purm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1762, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/songk1/miniconda3/envs/purm/lib/python3.11/site-packages/transformers/models/llama/modeling_llama.py", line 162, in forward
    down_proj = self.down_proj(self.act_fn(self.gate_proj(x)) * self.up_proj(x))
                                                                ^^^^^^^^^^^^^^^
  File "/home/songk1/miniconda3/envs/purm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1751, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/songk1/miniconda3/envs/purm/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1762, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/songk1/miniconda3/envs/purm/lib/python3.11/site-packages/bitsandbytes/nn/modules.py", line 1004, in forward
    out = bnb.matmul(x, self.weight, bias=self.bias, state=self.state)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/songk1/miniconda3/envs/purm/lib/python3.11/site-packages/bitsandbytes/autograd/_functions.py", line 369, in matmul
    return MatMul8bitLt.apply(A, B, out, bias, state)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/songk1/miniconda3/envs/purm/lib/python3.11/site-packages/torch/autograd/function.py", line 575, in apply
    return super().apply(*args, **kwargs)  # type: ignore[misc]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/songk1/miniconda3/envs/purm/lib/python3.11/site-packages/bitsandbytes/autograd/_functions.py", line 218, in forward
    output, subA = torch.ops.bitsandbytes.int8_mixed_scaled_mm(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/songk1/miniconda3/envs/purm/lib/python3.11/site-packages/torch/_ops.py", line 1158, in __call__
    return self._op(*args, **(kwargs or {}))
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/songk1/miniconda3/envs/purm/lib/python3.11/site-packages/torch/_compile.py", line 51, in inner
    return disable_fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/songk1/miniconda3/envs/purm/lib/python3.11/site-packages/torch/_dynamo/eval_frame.py", line 838, in _fn
    return fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^
  File "/home/songk1/miniconda3/envs/purm/lib/python3.11/site-packages/torch/library.py", line 719, in func_no_dynamo
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/home/songk1/miniconda3/envs/purm/lib/python3.11/site-packages/bitsandbytes/backends/default/ops.py", line 62, in _
    output = torch.ops.bitsandbytes.int8_scaled_mm.default(CA, CB, SCA, SCB, bias=bias, dtype=A.dtype)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/songk1/miniconda3/envs/purm/lib/python3.11/site-packages/torch/_ops.py", line 756, in __call__
    return self._op(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/songk1/miniconda3/envs/purm/lib/python3.11/site-packages/torch/_compile.py", line 51, in inner
    return disable_fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/songk1/miniconda3/envs/purm/lib/python3.11/site-packages/torch/_dynamo/eval_frame.py", line 838, in _fn
    return fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^
  File "/home/songk1/miniconda3/envs/purm/lib/python3.11/site-packages/torch/library.py", line 719, in func_no_dynamo
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/home/songk1/miniconda3/envs/purm/lib/python3.11/site-packages/bitsandbytes/backends/default/ops.py", line 81, in _
    return torch.ops.bitsandbytes.int8_mm_dequant.default(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/songk1/miniconda3/envs/purm/lib/python3.11/site-packages/torch/_ops.py", line 756, in __call__
    return self._op(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/songk1/miniconda3/envs/purm/lib/python3.11/site-packages/torch/_compile.py", line 51, in inner
    return disable_fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/songk1/miniconda3/envs/purm/lib/python3.11/site-packages/torch/_dynamo/eval_frame.py", line 838, in _fn
    return fn(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^
  File "/home/songk1/miniconda3/envs/purm/lib/python3.11/site-packages/torch/library.py", line 719, in func_no_dynamo
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/home/songk1/miniconda3/envs/purm/lib/python3.11/site-packages/bitsandbytes/backends/cuda/ops.py", line 117, in _
    ptrA, ptrRowStats, ptrColStats, ptrOut, ptrBias, numRows, numCols, _get_tensor_stream(A)
                                                                       ^^^^^^^^^^^^^^^^^^^^^
  File "/home/songk1/miniconda3/envs/purm/lib/python3.11/site-packages/bitsandbytes/functional.py", line 459, in _get_tensor_stream
    return ct.c_void_p(torch._C._cuda_getCurrentRawStream(tensor.device.index))
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
KeyboardInterrupt
